<div class="modal-container">
  <div class="modal-header">
    <h2>Edit Activity</h2>
    <button class="close-btn" (click)="onCancel()">âœ•</button>
  </div>

  <form [formGroup]="activityForm" class="modal-form">
    <!-- Activity Name -->
    <div class="form-group">
      <label for="activityName" class="label-required">Activity Name<span class="required">*</span></label>
      <input
        id="activityName"
        type="text"
        formControlName="name"
        class="form-input"
        placeholder="Enter activity name"
        maxlength="40"
      />
      <div class="char-counter" [class.warning]="activityForm.get('name')?.value?.length >= 35">
        {{ activityForm.get('name')?.value?.length || 0 }} / 40 characters
      </div>
      @if (activityForm.get('name')?.invalid && activityForm.get('name')?.touched) {
        <div class="error-message">
          @if (activityForm.get('name')?.errors?.['required']) {
            Activity name is required
          }
          @if (activityForm.get('name')?.errors?.['maxlength']) {
            Activity name cannot exceed 40 characters
          }
        </div>
      }
    </div>

    <!-- Category/Tag -->
    <div class="form-group">
      <label for="category">Category/Tag (Optional)</label>
      <input
        id="category"
        type="text"
        formControlName="category"
        class="form-input"
        placeholder="Select or type a category"
        maxlength="40"
        [matAutocomplete]="auto"
        #categoryInput="matAutocompleteTrigger"
        (focus)="categoryInput.openPanel()"
        aria-label="Category"
      />
      <mat-autocomplete #auto="matAutocomplete">
        @for (category of filteredCategories$ | async; track category) {
          <mat-option [value]="category">{{ category }}</mat-option>
        }
      </mat-autocomplete>
      <div class="char-counter" [class.warning]="activityForm.get('category')?.value?.length >= 35">
        {{ activityForm.get('category')?.value?.length || 0 }} / 40 characters
      </div>
    </div>

    <!-- Color Tag -->
    <div class="form-group">
      <label>Color Tag</label>
      <div class="color-picker-card">
        <div class="color-preview-large" [style.background-color]="selectedColorHex">
          <span class="preview-hex-overlay">{{ selectedColorHex }}</span>
        </div>
        <div class="slider-section">
          <div 
            class="color-slider-track" 
            #colorTrack 
            (click)="onSliderClick($event)"
            (touchmove)="onSliderTouchMove($event)"
          >
            <div 
              class="color-slider-thumb" 
              [style.left.%]="sliderPosition"
              [style.background-color]="selectedColorHex"
              (mousedown)="onThumbMouseDown($event)"
              (touchstart)="onThumbTouchStart($event)"
            ></div>
          </div>
          <div class="slider-label">Slide to pick your color</div>
        </div>
      </div>
    </div>

  </form>

  <div class="modal-actions">
    <button class="btn btn-cancel" (click)="onCancel()">Cancel</button>
    <button
      class="btn btn-primary"
      (click)="onSaveChanges()"
      [disabled]="activityForm.invalid"
    >
      Save Changes
    </button>
  </div>
</div>
