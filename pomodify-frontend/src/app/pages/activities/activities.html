<!-- activities.html - Activities List Page -->
<div class="activities-page">
  <!-- Sidebar -->
  <aside class="sidebar" [class.expanded]="sidebarExpanded()">
    <div class="logo" (click)="toggleSidebar()">
      <img src="assets/images/logo.png" alt="Pomodify Logo" width="32" height="32">
      @if (sidebarExpanded()) {
        <span class="app-name">Pomodify</span>
      }
    </div>

    <nav class="nav-icons">
      <button class="nav-icon" routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/dashboard')">
        <i class="fa-solid fa-layer-group"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Dashboard</span>
        }
      </button>
      <button class="nav-icon" routerLink="/activities" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/activities')">
        <i class="fa-solid fa-list-check"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Activities</span>
        }
      </button>
      <button class="nav-icon" routerLink="/report" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/report')">
        <i class="fa-solid fa-chart-line"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Reports</span>
        }
      </button>
      <button class="nav-icon" routerLink="/settings" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/settings')">
        <i class="fa-solid fa-gear"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Settings</span>
        }
      </button>
    </nav>

    <div class="nav-bottom">
      <button class="nav-icon" (click)="onLogout()">
        <i class="fa-solid fa-right-from-bracket"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Logout</span>
        }
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="user-profile">
        <button class="profile-btn" (click)="openProfileModal()">
          <i class="fa-solid fa-user"></i>
        </button>
      </div>
    </header>

    <!-- Page Content -->
    <div class="page-content">
      <!-- Page Header with Search and Filter -->
      <div class="page-header">
        <p class="page-subtitle">Manage and track all your activities</p>
        <button class="btn-primary" (click)="openCreateActivityModal()">
          <i class="fa-solid fa-plus"></i>
          Create Activity
        </button>
      </div>

      <!-- Search and Filter Section -->
      <div class="search-section">
        <div class="search-bar">
          <i class="fa-solid fa-magnifying-glass search-icon"></i>
          <input
            type="text"
            placeholder="Search activities..."
            [value]="searchQuery()"
            (input)="updateSearchQuery($any($event.target).value)"
          />
        </div>
        
        <!-- Category Dropdown -->
        <div class="category-dropdown-container">
          <button class="category-dropdown-btn" (click)="toggleCategoryDropdown()">
            <i class="fa-solid fa-list"></i>
            <span>{{ selectedCategory() || 'All Categories' }}</span>
            <i class="fa-solid fa-chevron-down" [class.rotated]="categoryDropdownOpen()"></i>
          </button>
          
          @if (categoryDropdownOpen()) {
            <div class="category-dropdown-menu">
              <button 
                class="category-item"
                [class.active]="!selectedCategory()"
                (click)="selectCategory(null); toggleCategoryDropdown()"
              >
                <i class="fa-solid fa-inbox"></i>
                <span>All Activities</span>
              </button>
              
              @for (category of categories(); track category) {
                <button 
                  class="category-item"
                  [class.active]="selectedCategoryName() === category"
                  (click)="selectCategory(category)"
                >
                  <i class="fa-solid fa-folder"></i>
                  <span>{{ category }}</span>
                </button>
              }
            </div>
          }
        </div>
      </div>

      <!-- Loading State -->
      @if (isLoading()) {
        <div class="loading-state">
          <div class="spinner"></div>
          <p>Loading activities...</p>
        </div>
      }

      <!-- Error State -->
      @else if (error()) {
        <div class="error-state">
          <div class="error-icon">
            <i class="fa-solid fa-exclamation-circle"></i>
          </div>
          <h3 class="error-title">Error Loading Activities</h3>
          <p class="error-message">{{ error() }}</p>
          <button class="btn-retry" (click)="loadActivities()">
            <i class="fa-solid fa-refresh"></i>
            Retry
          </button>
        </div>
      }

      <!-- Empty State (No Activities) -->
      @else if (filteredActivities().length === 0 && totalItems() === 0) {
        <div class="empty-state">
          <div class="empty-icon">
            <i class="fa-solid fa-list-check"></i>
          </div>
          <h2 class="empty-title">No Activities Yet</h2>
          <p class="empty-subtitle">Create your first activity to get started with Pomodoro tracking</p>
          <button class="btn-create-first" (click)="openCreateActivityModal()">
            <i class="fa-solid fa-plus"></i>
            Create Your First Activity
          </button>
        </div>
      }

      <!-- Activities Grid -->
      @else {
        <div class="activities-content">
          <!-- Activities Grid (4 columns) -->
          <div class="activities-grid">
            @for (activity of filteredActivities(); track activity.activityId) {
              <div class="activity-card" [style.--card-color]="activity.colorTag || 'teal'">
                <div class="card-header">
                  <div class="activity-icon" [style.color]="activity.colorTag || 'teal'">
                    <i [class]="getIconClass(activity)"></i>
                  </div>
                  <div class="card-actions">
                    <button class="icon-btn" (click)="openEditActivityModal(activity)" title="Edit">
                      <i class="fa-solid fa-pen"></i>
                    </button>
                    <button class="icon-btn delete" (click)="openDeleteActivityModal(activity)" title="Delete">
                      <i class="fa-solid fa-trash"></i>
                    </button>
                  </div>
                </div>
                
                <div class="card-body">
                  <h3 class="activity-name">{{ activity.activityTitle }}</h3>
                  @if (activity.activityDescription) {
                    <p class="activity-desc">{{ activity.activityDescription }}</p>
                  }
                  @if (activity.categoryName) {
                    <span class="activity-category">{{ activity.categoryName }}</span>
                  }
                </div>

                <div class="card-footer">
                  <button class="btn-add-session" (click)="openAddSessionModal(activity)">
                    <i class="fa-solid fa-plus"></i>
                    Add Session
                  </button>
                </div>
              </div>
            }
          </div>

          <!-- Pagination -->
          @if (totalPages() > 1) {
            <div class="pagination">
              <button class="page-btn" 
                      [disabled]="currentPage() === 1"
                      (click)="previousPage()">
                <i class="fa-solid fa-chevron-left"></i>
                Previous
              </button>

              <div class="page-numbers">
                <span class="page-info">
                  Page {{ currentPage() }} of {{ totalPages() }}
                </span>
              </div>

              <button class="page-btn" 
                      [disabled]="currentPage() === totalPages()"
                      (click)="nextPage()">
                Next
                <i class="fa-solid fa-chevron-right"></i>
              </button>
            </div>
          }
        </div>
      }
    </div>
  </main>
</div>
