<!-- activities.html - Timer Only Page -->
<div class="activities-page">
  <!-- Sidebar -->
  <aside class="sidebar" [class.expanded]="sidebarExpanded()">
    <div class="logo" (click)="toggleSidebar()">
      <img src="assets/images/logo.png" alt="Pomodify Logo" width="32" height="32">
      @if (sidebarExpanded()) {
        <span class="app-name">Pomodify</span>
      }
    </div>

    <nav class="nav-icons">
      <button class="nav-icon" routerLink="/dashboard" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/dashboard')">
        <i class="fa-solid fa-house"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Dashboard</span>
        }
      </button>
      <button class="nav-icon" routerLink="/activities" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/activities')">
        <i class="fa-solid fa-list-check"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Activities</span>
        }
      </button>
      <button class="nav-icon" routerLink="/report" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/report')">
        <i class="fa-solid fa-chart-line"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Reports</span>
        }
      </button>
      <button class="nav-icon" routerLink="/settings" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }" (click)="onNavIconClick($event, '/settings')">
        <i class="fa-solid fa-gear"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Settings</span>
        }
      </button>
    </nav>

    <div class="nav-bottom">
      <button class="nav-icon" (click)="onLogout()">
        <i class="fa-solid fa-right-from-bracket"></i>
        @if (sidebarExpanded()) {
          <span class="nav-text">Logout</span>
        }
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="theme-toggle">
        <button class="theme-btn" (click)="onToggleTheme()">
          <i class="fa-solid fa-moon"></i>
        </button>
      </div>
      <div class="user-profile">
        <button class="profile-btn" (click)="openProfileModal()">
          <i class="fa-solid fa-user"></i>
        </button>
      </div>
    </header>

    <!-- Page Content -->
    <div class="page-content">
      <!-- Timer View (Pomodoro) -->
      @if (backendSession() && activity()) {
        <div class="timer-view-full">
          <div class="timer-header">
            <button class="back-to-activities" (click)="cancelSession()">
              <i class="fa-solid fa-arrow-left"></i>
              Back to Dashboard
            </button>
            <div class="activity-info">
              <h1 class="timer-activity-title">{{ activity()!.activityTitle }}</h1>
              <p class="timer-activity-desc">{{ activity()!.activityDescription }}</p>
            </div>
          </div>

          <div class="timer-container" [style.--accent-color]="getColorHex(activity()!.colorTag || 'teal')" [ngClass]="'theme-' + mode">
            <!-- Main Timer Display -->
            <div class="timer-display-section">
              <div class="timer-phase-badge" [ngClass]="currentPhase">
                {{ currentPhase === 'focus' ? 'ðŸ”¥ Focus Time' : 'â˜• Break Time' }}
              </div>
              
              <div class="timer-circle">
                <svg class="timer-progress" viewBox="0 0 100 100">
                  <defs>
                    <linearGradient id="timerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                      <stop offset="0%" [attr.stop-color]="getColorHex(activity()!.colorTag || 'teal')" />
                      <stop offset="100%" [attr.stop-color]="getColorHex(activity()!.colorTag || 'teal')" stop-opacity="0.7" />
                    </linearGradient>
                  </defs>
                  <circle cx="50" cy="50" r="45" class="progress-bg"></circle>
                  <circle cx="50" cy="50" r="45" class="progress-fill" 
                          [style.stroke-dashoffset]="283 - (283 * (timeRemaining() / (currentPhase === 'focus' ? focusMinutes * 60 : breakMinutes * 60)))"></circle>
                </svg>
                <div class="timer-time">{{ getTimerDisplay() }}</div>
              </div>

              <div class="timer-stats">
                <div class="stat-item">
                  <span class="stat-label">Cycles Completed</span>
                  <span class="stat-value">{{ cyclesCompleted }} <span class="stat-max">{{ mode === 'classic' ? '/ ' + cycles : '/ âˆž' }}</span></span>
                </div>
                @if (mode === 'classic') {
                  <div class="stat-item">
                    <span class="stat-label">Total Session</span>
                    <span class="stat-value">{{ (getTotalSessionMinutes() / 60) | number: '1.0-1' }}h</span>
                  </div>
                }
              </div>
            </div>

            <!-- Mode Selector and Settings -->
            <div class="timer-modes-section">
              <div class="mode-selector">
                <button class="mode-btn" 
                        [class.active]="mode === 'classic'"
                        (click)="switchMode('classic')"
                        [disabled]="isRunning() || isPaused">
                  <i class="fa-solid fa-list"></i>
                  Classic Mode
                </button>
                <button class="mode-btn" 
                        [class.active]="mode === 'freestyle'"
                        (click)="switchMode('freestyle')"
                        [disabled]="isRunning() || isPaused">
                  <i class="fa-solid fa-wand-magic-sparkles"></i>
                  Freestyle Mode
                </button>
              </div>

              <!-- Settings Panel -->
              <div class="settings-panel">
                <div class="settings-group">
                  <label class="setting-label">Focus Time</label>
                  <div class="time-input-group">
                    <span class="readonly-value">{{ focusMinutes }} min</span>
                    <small class="setting-note">(Set when creating session)</small>
                  </div>
                </div>

                <div class="settings-group">
                  <label class="setting-label">Break Time</label>
                  <div class="time-input-group">
                    <span class="readonly-value">{{ breakMinutes }} min</span>
                    <small class="setting-note">(Set when creating session)</small>
                  </div>
                </div>

                <div class="settings-group auto-calculated">
                  <label class="setting-label">Cycle Duration</label>
                  <div class="auto-value">{{ getCycleDuration() }} min</div>
                </div>

                @if (mode === 'classic') {
                  <div class="settings-group">
                    <label class="setting-label">Rounds</label>
                    <div class="time-input-group">
                      <span class="readonly-value">{{ cycles }} rounds</span>
                      <small class="setting-note">(Set when creating session)</small>
                    </div>
                  </div>

                  <div class="settings-group auto-calculated">
                    <label class="setting-label">Total Session</label>
                    <div class="auto-value">{{ (getTotalSessionMinutes() / 60) | number: '1.0-1' }} hrs</div>
                  </div>
                } @else {
                  <div class="settings-group auto-calculated">
                    <label class="setting-label">Mode</label>
                    <div class="auto-value">Continuous âˆž</div>
                  </div>
                }
              </div>
            </div>

            <!-- Timer Controls -->
            <div class="timer-controls">
              @if (!isRunning() && !isPaused) {
                <button class="control-btn start-btn" (click)="startTimer()">
                  <i class="fa-solid fa-play"></i>
                  Start Session
                </button>
              } @else if (isRunning() && !isPaused) {
                <button class="control-btn pause-btn" (click)="pauseTimer()">
                  <i class="fa-solid fa-pause"></i>
                  Pause
                </button>
              } @else if (isPaused) {
                <button class="control-btn resume-btn" (click)="resumeTimer()">
                  <i class="fa-solid fa-play"></i>
                  Resume
                </button>
                <button class="control-btn reset-btn" (click)="resetCurrentPhase()">
                  <i class="fa-solid fa-arrow-rotate-right"></i>
                  Reset Phase
                </button>
              }

              <button class="control-btn stop-btn" (click)="stopCurrentCycle()">
                <i class="fa-solid fa-stop"></i>
                Stop Cycle
              </button>

              <button class="control-btn cancel-btn" (click)="cancelSession()">
                <i class="fa-solid fa-times"></i>
                Cancel
              </button>
            </div>
          </div>
        </div>
      } @else {
        <!-- No Activity Selected -->
        <div class="no-activity-state">
          <div class="empty-state-icon">
            <i class="fa-solid fa-clock"></i>
          </div>
          <h2 class="empty-state-title">No Timer Session</h2>
          <p class="empty-state-subtitle">Please select an activity from the Dashboard to start a timer session.</p>
          <button class="btn-back-to-dashboard" routerLink="/dashboard">
            <i class="fa-solid fa-arrow-left"></i>
            Go to Dashboard
          </button>
        </div>
      }
    </div>
  </main>
</div>
