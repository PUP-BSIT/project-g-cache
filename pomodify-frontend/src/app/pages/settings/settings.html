<div class="settings-page">
  <!-- Mobile Overlay Backdrop -->
  @if (sidebarExpanded()) {
    <div class="mobile-overlay" (click)="toggleSidebar()"></div>
  }
  
  <!-- Sidebar -->
  <aside class="sidebar" [class.expanded]="sidebarExpanded()">
    <!-- Close Toggle Button -->
    <button class="sidebar-close-btn" (click)="toggleSidebar()" title="Toggle Sidebar">
      <i class="fa-solid fa-xmark"></i>
    </button>

    <div class="logo">
      <img src="assets/images/logo.png" alt="Pomodify Logo" width="32" height="32">
      @if(sidebarExpanded()) {
        <span class="app-name">Pomodify</span>
      }
    </div>

    <nav class="nav-icons">
      <button class="nav-icon" routerLink="/dashboard" routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }">
        <i class="fa-solid fa-layer-group"></i>
        @if(sidebarExpanded()) {
          <span class="nav-text">Dashboard</span>
        }
      </button>
      <button class="nav-icon" routerLink="/activities" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
        <i class="fa-solid fa-list-check"></i>
        @if(sidebarExpanded()) {
          <span class="nav-text">Activities</span>
        }
      </button>
      <button class="nav-icon" routerLink="/report" routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }">
        <i class="fa-solid fa-chart-line"></i>
        @if(sidebarExpanded()) {
          <span class="nav-text">Reports</span>
        }
      </button>
      <button class="nav-icon active" routerLink="/settings" routerLinkActive="active"
              [routerLinkActiveOptions]="{ exact: true }">
        <i class="fa-solid fa-gear"></i>
        @if(sidebarExpanded()) {
          <span class="nav-text">Settings</span>
        }
      </button>
    </nav>

    <div class="nav-bottom">
      <button class="nav-icon" (click)="onLogout()">
        <i class="fa-solid fa-right-from-bracket"></i>
        @if(sidebarExpanded()) {
          <span class="nav-text">Logout</span>
        }
      </button>
    </div>
  </aside>

  <!-- Main Content -->
  <main class="main-content">
    <!-- Header -->
    <header class="header">
      <div class="header-left">
        <button class="hamburger-btn" (click)="toggleSidebar()" aria-label="Toggle navigation">
          <i class="fa-solid fa-bars"></i>
        </button>
        <h1 class="page-title">Settings</h1>
      </div>
      <div class="user-profile">
        <button class="profile-btn" (click)="openProfileModal()">
          <i class="fa-solid fa-user"></i>
        </button>
      </div>
    </header>

    <!-- Settings Content -->
    <div class="settings-container">
      <div class="settings-header">
        <h1 class="settings-title">App Settings</h1>
        @if (autoSaveStatus() === 'saving') {
          <div class="auto-save-indicator saving">
            <i class="fa-solid fa-spinner fa-spin"></i>
            <span>Saving...</span>
          </div>
        }
        @if (autoSaveStatus() === 'saved') {
          <div class="auto-save-indicator saved">
            <i class="fa-solid fa-check"></i>
            <span>Saved automatically</span>
          </div>
        }
      </div>

      <div class="settings-grid">

      <!-- Sound Settings Section -->
      <section class="settings-section">
        <h2 class="section-title">
          <img src="assets/images/sound.png" alt="Sound" class="section-icon"> Sound Settings
        </h2>
        
        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Notification Sound</h3>
            <p class="setting-description">Play sound when timer completes</p>
          </div>
          <div class="toggle-switch">
            <input type="checkbox" id="sound-toggle" class="toggle-input" 
                   [checked]="soundEnabled()" 
                   (change)="toggleSound()">
            <label for="sound-toggle" class="toggle-label"></label>
          </div>
        </div>

        @if (soundEnabled()) {
          <div class="setting-item">
            <div class="setting-info">
              <h3 class="setting-label">Sound Type</h3>
            </div>
            <div class="setting-control">
              <select class="sound-select" 
                      #soundSelect
                      [value]="soundType()" 
                      (change)="onSoundTypeChange($event)">
                @for (type of soundTypes; track type.value) {
                  <option [value]="type.value">{{ type.label }}</option>
                }
              </select>
              <button class="test-btn" (click)="testSound()">
                <i class="fa-solid fa-volume-high"></i> Test
              </button>
            </div>
          </div>

          <div class="setting-item">
            <div class="setting-info">
              <h3 class="setting-label">Volume</h3>
              <p class="setting-description">{{ volume() }}%</p>
            </div>
            <div class="setting-control">
              <input type="range" 
                     min="0" 
                     max="100" 
                     [value]="volume()" 
                     (input)="onVolumeChange($event)" 
                     class="volume-slider">
            </div>
          </div>


        }
      </section>

      <!-- Auto-Start Settings Section -->
      <section class="settings-section">
        <h2 class="section-title">
          <img src="assets/images/start.png" alt="Auto-Start" class="section-icon"> Auto-Start Options
        </h2>
        
        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Auto-start Breaks</h3>
            <p class="setting-description">Automatically start break after pomodoro completes</p>
          </div>
          <div class="toggle-switch">
            <input type="checkbox" id="auto-break-toggle" class="toggle-input" 
                   [checked]="autoStartBreaks()" 
                   (change)="toggleAutoStartBreaks()">
            <label for="auto-break-toggle" class="toggle-label"></label>
          </div>
        </div>

        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Auto-start Pomodoros</h3>
            <p class="setting-description">Automatically start next pomodoro after break</p>
          </div>
          <div class="toggle-switch">
            <input type="checkbox" id="auto-pomodoro-toggle" class="toggle-input" 
                   [checked]="autoStartPomodoros()" 
                   (change)="toggleAutoStartPomodoros()">
            <label for="auto-pomodoro-toggle" class="toggle-label"></label>
          </div>
        </div>

        @if (autoStartBreaks() || autoStartPomodoros()) {
          <div class="info-box">
            <i class="fa-solid fa-info-circle"></i>
            <p>You'll see a 3-second countdown before auto-start. You can cancel anytime.</p>
          </div>
        }
      </section>

      <!-- Appearance Section -->
      <section class="settings-section">
        <h2 class="section-title">
          <img src="assets/images/appearance.png" alt="Appearance" class="section-icon"> Appearance
        </h2>
        
        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Theme</h3>
            <p class="setting-description">Switch between light and dark mode</p>
          </div>
          <button class="theme-toggle-btn" (click)="onToggleTheme()">
            @if (isDarkMode()) {
              <i class="fa-solid fa-sun"></i>
              <span>Light Mode</span>
            } @else {
              <i class="fa-solid fa-moon"></i>
              <span>Dark Mode</span>
            }
          </button>
        </div>
      </section>

      <!-- Notifications Section -->
      <section class="settings-section">
        <h2 class="section-title">
          <img src="assets/images/notification.png" alt="Notifications" class="section-icon"> Notifications
        </h2>
        
        <div class="setting-item">
          <div class="setting-info">
            <h3 class="setting-label">Notifications</h3>
            <p class="setting-description">Desktop notifications when tab is closed</p>
          </div>
          <div class="setting-control">
            <div class="toggle-switch">
              <input type="checkbox" id="notifications-toggle" class="toggle-input" 
                     [checked]="notificationsEnabled()" 
                     (change)="toggleNotifications()">
              <label for="notifications-toggle" class="toggle-label"></label>
            </div>
            @if (notificationsEnabled()) {
              <button class="test-btn" (click)="testNotification()">
                <i class="fa-solid fa-bell"></i> Test
              </button>
            }
          </div>
        </div>


      </section>

      <!-- Privacy & Data Section -->
      <section class="settings-section data-section">
        <h2 class="section-title">
          <img src="assets/images/privacy.png" alt="Privacy" class="section-icon"> Privacy & Data
        </h2>
        
        <div class="data-action-item">
          <div class="data-action-info">
            <h3 class="data-action-label">Clear Session History</h3>
            <p class="data-action-description">Delete all past sessions (with confirmation)</p>
          </div>
          <button class="data-action-btn" (click)="onClearSessions()">
            <i class="fa-solid fa-trash"></i>
            Clear
          </button>
        </div>

        <div class="data-action-item">
          <div class="data-action-info">
            <h3 class="data-action-label">Clear Activity Data</h3>
            <p class="data-action-description">Delete all activities</p>
          </div>
          <button class="data-action-btn" (click)="onClearActivities()">
            <i class="fa-solid fa-trash"></i>
            Clear
          </button>
        </div>
      </section>

      <!-- Actions Section -->
      <section class="settings-section actions-section">
        <div class="action-buttons">
          <button class="btn btn-delete" (click)="onDeleteAccount()">
            <i class="fa-solid fa-user-xmark"></i>
            Delete my Account
          </button>
        </div>
      </section>
      </div> <!-- Close settings-grid -->
    </div>
  </main>

  <!-- Delete Account Confirmation Modal -->
  @if (showDeleteModal()) {
    <div class="modal-overlay" (click)="onCancelDelete()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <i class="fa-solid fa-triangle-exclamation warning-icon"></i>
          <h2 class="modal-title">WARNING: Delete Account</h2>
        </div>
        
        <div class="modal-body">
          <p class="modal-text">This will permanently delete:</p>
          <ul class="delete-list">
            <li>Your account</li>
            <li>All sessions</li>
            <li>All activities</li>
            <li>All settings</li>
          </ul>
          <p class="modal-warning">This action CANNOT be undone!</p>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn btn-ok" (click)="onConfirmDelete()">OK</button>
          <button class="modal-btn btn-cancel" (click)="onCancelDelete()">Cancel</button>
        </div>
      </div>
    </div>
  }

  <!-- Success Modal -->
  @if (showSuccessModal()) {
    <div class="modal-overlay" (click)="onCloseSuccessModal()">
      <div class="modal-content success-modal" (click)="$event.stopPropagation()">
        <div class="modal-body">
          <p class="success-text">Settings saved successfully!</p>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn btn-ok" (click)="onCloseSuccessModal()">OK</button>
        </div>
      </div>
    </div>
  }

  <!-- Clear Session History Modal -->
  @if (showClearSessionsModal()) {
    <div class="modal-overlay" (click)="onCancelClearSessions()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <i class="fa-solid fa-triangle-exclamation warning-icon"></i>
          <h2 class="modal-title">Clear Session History</h2>
        </div>
        
        <div class="modal-body">
          <p class="modal-text">Are you sure you want to delete all past sessions?</p>
          <p class="modal-warning">This action cannot be undone!</p>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn btn-ok" (click)="onConfirmClearSessions()">OK</button>
          <button class="modal-btn btn-cancel" (click)="onCancelClearSessions()">Cancel</button>
        </div>
      </div>
    </div>
  }

  <!-- Clear Activity Data Modal -->
  @if (showClearActivitiesModal()) {
    <div class="modal-overlay" (click)="onCancelClearActivities()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <i class="fa-solid fa-triangle-exclamation warning-icon"></i>
          <h2 class="modal-title">Clear Activity Data</h2>
        </div>
        
        <div class="modal-body">
          <p class="modal-text">Are you sure you want to delete all activities?</p>
          <p class="modal-warning">This action cannot be undone!</p>
        </div>
        
        <div class="modal-actions">
          <button class="modal-btn btn-ok" (click)="onConfirmClearActivities()">OK</button>
          <button class="modal-btn btn-cancel" (click)="onCancelClearActivities()">Cancel</button>
        </div>
      </div>
    </div>
  }
</div>
